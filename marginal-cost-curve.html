<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <title>OJI Cost Curves — Q2b (Output-Based)</title>
  <style>
    html, body {
      margin: 0;
      height: 100%;
      width: 100%;
      background: #ffffff;
      color: #0f172a;
      font-family: Inter, system-ui, sans-serif;
      display: flex;
      flex-direction: column;
    }
    canvas {
      flex: 1;
      width: 100% !important;
      height: 100% !important;
    }
    header {
      padding: 16px 24px;
      border-bottom: 1px solid #e5e7eb;
      background: #f8fafc;
    }
    header h1 {
      margin: 0;
      font-size: clamp(16px, 2vw, 18px);
    }
    header .sub {
      color: #6b7280;
      font-size: clamp(12px, 1.5vw, 13px);
    }
  </style>
</head>
<body>
  <header>
    <h1>Orange Juice Incorporated — Average & Marginal Cost Curves (Q2b)</h1>
    <div class="sub">Average Fixed, Variable, Total, and Marginal Cost per Litre (Output in Litres)</div>
  </header>
  <canvas id="chart"></canvas>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script>
    const outputL = [297000, 445500, 594000, 742500, 891000, 1039500, 1188000, 1336500, 1485000, 1633500];
    const AVC = [1.870, 1.458, 1.094, 1.171, 1.289, 1.377, 1.783, 2.601, 3.526, 7.054];
    const TFC = 682000;

    const AFC = outputL.map(Q => TFC / Q);
    const ATC = AFC.map((a, i) => a + AVC[i]);
    const MC = [AVC[0], ...AVC.slice(1).map((v, i) => {
      const dTVC = (outputL[i + 1] * AVC[i + 1] - outputL[i] * AVC[i]);
      const dQ = outputL[i + 1] - outputL[i];
      return dTVC / dQ;
    })];

    function formatMoney(n) {
      return n.toLocaleString('en-AU', { minimumFractionDigits: 3, maximumFractionDigits: 3 });
    }

    const ctx = document.getElementById('chart').getContext('2d');
    new Chart(ctx, {
      type: 'line',
      data: {
        labels: outputL.map(q => q.toLocaleString('en-AU') + ' L'),
        datasets: [
          { label: 'Average Fixed Cost (AFC)', data: AFC, borderColor: '#3b82f6', borderWidth: 2, tension: 0.25 },
          { label: 'Average Variable Cost (AVC)', data: AVC, borderColor: '#ef7d00', borderWidth: 2, tension: 0.25 },
          { label: 'Average Total Cost (ATC)', data: ATC, borderColor: '#22c55e', borderWidth: 2, tension: 0.25 },
          { label: 'Marginal Cost (MC)', data: MC, borderColor: '#f43f5e', borderWidth: 2, borderDash: [6, 4], tension: 0.25 }
        ]
      },
      options: {
        responsive: true,
        maintainAspectRatio: false,
        interaction: { mode: 'nearest', intersect: true },
        plugins: {
          legend: { position: 'bottom' },
          tooltip: {
            callbacks: {
              title: ctx => `Output: ${ctx[0].label}`,
              label: ctx => `${ctx.dataset.label}: $${formatMoney(ctx.parsed.y)}/L`
            }
          }
        },
        scales: {
          y: {
            title: { display: true, text: 'Cost ($/L)' },
            grid: { color: 'rgba(0,0,0,0.05)' }
          },
          x: {
            title: { display: true, text: 'Juice Output (L)' },
            grid: { color: 'rgba(0,0,0,0.03)' }
          }
        },
        onClick: (e, activeEls) => {
          if (activeEls.length > 0) {
            const datasetIndex = activeEls[0].datasetIndex;
            const dataIndex = activeEls[0].index;
            const label = e.chart.data.labels[dataIndex];
            const value = e.chart.data.datasets[datasetIndex].data[dataIndex];
            alert(`${e.chart.data.datasets[datasetIndex].label} at ${label}: $${formatMoney(value)}/L`);
          }
        }
      }
    });
  </script>
</body>
</html>
